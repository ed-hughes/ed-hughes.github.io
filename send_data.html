
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> - StaffCustomWidgetApp</title>
</head>
<body>
    <header b-igtbowox0r>
    </header>
    <div b-igtbowox0r class="container">
        <main b-igtbowox0r role="main" class="pb-3">
            <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Staff Lookup</title>

    <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>

    <style>
        body {
            font-family: Arial;
            background-color: #1f5f9f;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: auto;
        }

        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .field {
            flex: 1;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .required {
            color: red;
        }

        input, button {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: none;
            font-size: 14px;
        }

        input:disabled {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }

        button {
            background-color: #ffd800;
            color: #1f5f9f;
            font-weight: bold;
            cursor: pointer;
            max-width: 150px;
        }

        #hireDate {
            max-width: 400px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="field">
                <label>Staff No</label>
                <input type="text" id="staffNo" placeholder="Enter Staff No">
            </div>
            <div class="field">
                <label>&nbsp;</label>
                <button id="fetchBtn" type="button">Fetch</button>
            </div>
        </div>
        <div class="row">
            <div class="field">
                <label>Staff Name <span class="required">*</span></label>
                <input type="text" id="staffName">
            </div>
            <div class="field">
                <label>Email <span class="required">*</span></label>
                <input type="email" id="email">
            </div>
        </div>
        <div class="row">
            <div class="field">
                <label>Designation <span class="required">*</span></label>
                <input type="text" id="designation">
            </div>
            <div class="field">
                <label>Department <span class="required">*</span></label>
                <input type="text" id="department">
            </div>
        </div>
        <div class="row">
            <div class="field">
                <label>Hire Date <span class="required">*</span></label>
                <input type="date" id="hireDate">
            </div>
        </div>
    </div>

    <script>
        // Use relative API path to work under /staffwidget deployment
        const API = "./api/staff"; 
        const fieldIds = ["staffName", "email", "designation", "department", "hireDate"];
        function setFormDisabled(disabled) {
            fieldIds.forEach(id => document.getElementById(id).disabled = disabled);
        }

        function clearForm() {
            fieldIds.forEach(id => document.getElementById(id).value = "");
        }

        function toDateOnly(value) {
            return value ? value.split("T")[0] : "";
        }

        function getData(){
         const value =
                "Employee Name: " + document.getElementById("staffName").value +
                "\t\tEmail: " + document.getElementById("email").value + "\n" +
                "Employee Number: " + document.getElementById("staffNo").value +
                "\t\tPosition: " + document.getElementById("designation").value + "\n" +
                "Department: " + document.getElementById("department").value +
                "\t\tDate of Joining: " + document.getElementById("hireDate").value ;
return {
value, 
valid: !!value
}
        }

function notifyChange() {
    JFCustomWidget.sendData(getData());
}

        async function fetchStaff() {
            try {
                //mockedData
                const d = {
firstName: "First",
lastName: "Last",
email: "Email",
designation: "Designation",
department: "Department",
hireDate: "2025-01-01"
}


                document.getElementById("staffName").value =
                    `${d.firstName || ""} ${d.lastName || ""}`.trim();
                document.getElementById("email").value = d.email || "";
                document.getElementById("designation").value = d.designation || "";
                document.getElementById("department").value = d.department || "";
                document.getElementById("hireDate").value = toDateOnly(d.doj);

                setFormDisabled(true);
notifyChange();
            } catch (err) {
                clearForm();
                setFormDisabled(false);
                alert(err.message);
            }
        }

        // JotForm widget integration
        JFCustomWidget.subscribe("ready", function() {
            // Clear form if Staff No is edited
            document.getElementById("staffNo").addEventListener("input", () => {
                clearForm();
                setFormDisabled(false);
            });

            // Fetch button
            document.getElementById("fetchBtn").addEventListener("click", fetchStaff);

            // Enter key triggers fetch
            document.getElementById("staffNo").addEventListener("keypress", e => {
                if (e.key === "Enter") fetchStaff();
            });

fieldIds.forEach(id => {
    document.getElementById(id).addEventListener("input", notifyChange);
});

        });
        JFCustomWidget.subscribe("submit", function () {

           
  
            JFCustomWidget.sendSubmit({
                valid: true,
                value: getData()
            });
        });
    </script>

</body>
</html>

        </main>
    </div>

    <footer b-igtbowox0r class="border-top footer text-muted">
    </footer>
</body>
</html>
