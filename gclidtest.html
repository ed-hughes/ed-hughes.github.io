<!doctype html>
<html>
  <head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://demo.jotform.com/s/umd/f5e61623280/for-formuser.js"></script>
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="pragma" content="no-cache" />
  </head>
  <body>
    <script type="text/javascript">
      (function(){
        function PrismEmitter() {
        const params = JFCustomWidget.getWidgetSettings();
        const nameField = params.nameField;
        const emailField = params.emailField;
        const phoneField = params.phoneField

        const prismFields = [nameField, emailField, phoneField];
        
        this.getData = getData;        
        this.init = init;

        function init(){
          console.log("init");
        }
        
        function getData() {
          JFCustomWidget.getFieldsValueById(prismFields, function(res){
            const name = res.data.find((item) => item.selector == nameField).value
            const email = res.data.find((item) => item.selector == emailField).value
            const phone = res.data.find((item) => item.selector == phoneField).value
            top.postMessage({type: "prism_message", data: {name, email, phone }}, "*") 
          })

          return {
            valid: true,
            value: ""
          };
        }
      }

      JFCustomWidget.subscribe("ready", function (data) {
        var widget = new PrismEmitter();
        widget.init();
        
        JFCustomWidget.subscribe("submit", function () {
          JFCustomWidget.sendSubmit(widget.getData());
        });
      });})();
    </script>
  </body>
</html>
