<!doctype html>
<html>
  <head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="pragma" content="no-cache" />
  </head>
  <style></style>
  <body>
    <div id="reviewArea">
    </div>
    <script type="text/javascript">
      function GCLIDExample() {
        // get widget parameters if any using getWidgetSettings for all, or getWidgetSetting('name') for a specific one.
        // const params = JFCustomWidget.getWidgetSettings();

        // exposed functions
        this.init = init;
        this.getData = getData;
        const otherFields = [
          'control_textbox',
          'control_textarea',
          'control_dropdown',
          'control_datetime',
          'control_phone',
          'control_fullname',
          'control_email'
        ]
        
        // initialization of the widget
        function init(formData) {
          console.log("Hello world!");
          // window.parent.postMessage( JSON.stringify({sectionBackgroundColor: "#ff0000", sizeTitle: "200px", sectionTextColor: "#000", height: "20px"}), '*')
          window.parent.parent.postMessage("hello therethere this is a message!!", "*") 
        }

        // get widget data
        function getData() {

          JFCustomWidget.getFieldsValueByName(otherFields, function(res){
              const name = res.data.find((item) => item.selector == "control_fullname")
              const email = res.data.find((item) => item.selector == "control_email")
              const phone = res.data.find((item) => item.selector == "control_phone")
              window.parent.parent.postMessage({source: "rw", data: {name, email, phone }}, "*") 
          })
          // Commenting out the below blocks the submit event, you wouldn't want to do this in reality. But I've done this here so you can see the prismFormttedData logged out
          // return {
          //   valid: true,
          //   value: "TEST"
          // };
        }
      }

      // always subscribe to ready event and implement widget related code
      // inside callback function , it is the best practice while developing widgets
      JFCustomWidget.subscribe("ready", function (data) {
        var widget = new GCLIDExample();
        widget.init(data);

        JFCustomWidget.subscribe("submit", function () {
          JFCustomWidget.sendSubmit(widget.getData());
        });
      });
    </script>
  </body>
</html>
