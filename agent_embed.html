<html>
<body>
  <script>
    let pendingContext = null;

    window.addEventListener("message", e => {
      console.log("Parent received message:", e.origin, e.data);
      if (e.origin === "https://demo.jotform.com") {
        if (e.data.chatID) {
          pendingContext = e.data.chatID;
          console.log("Received chatID:", pendingContext);
        }
        if (e.data.message?.response?.action === "agent-loaded" && pendingContext) {
          const ctx = window.AgentInitializer.createJotformAgentContext(pendingContext);
          ctx.set("Order number is 1234");
          console.log("Order number sent for chatID:", pendingContext);
		pendingContext = null;
        }
      }
    });
  </script>
  <script src="https://demo.jotform.com/agent/embedjs/019c232d911b7e3181c549bb282d1bb45631/embed.js"></script>
</body>
</html>
